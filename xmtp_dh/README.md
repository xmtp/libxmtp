# Uniffi-based bindings for Diffie-Hellman operation

This crate provides Uniffi bindings for a Rust-based Diffie-Hellman operation to unblock XMTP Android performance issues (https://github.com/xmtp/xmtp-android/pull/75).

# Status

- Android is tested end-to-end via an example app in `examples/`.
- iOS has not been tested.

# Consuming this crate

The generated artifacts of this crate are the bindings interface (`xmtp_dh.kt`) generated by `uniffi`, and the cross-compiled binaries (`jniLibs/`) generated by `cross`.

- Run `./setup_android_example.sh` to copy these artifacts into the example Android app. Alternatively, modify the script to set up an app of your choice.
- Open the `build.gradle` of the example Android app in Android Studio.

# Rebuilding this crate

The generated bindings (`xmtp_dh.kt`) and the cross-compiled binaries (`jniLibs`) have been committed alongside the crate so you do not need to rebuild unless you make changes. The build is very slow (~3 mins on incremental builds, longer on full builds).

- Run `./gen_kotlin.sh` to re-generate the bindings
- Install Docker
- Install [cross-rs](https://github.com/cross-rs/cross) for zero setup cross-platform builds
- Run `./cross_build.sh` to cross-compile (this is SLOW)

# Releasing

The bindings and binaries are automatically generated on every commit by the Build action and packaged as an artifact `xmtp_dh.zip` that can be unzipped over the target repo (e.g. xmtp/xmtp-android). To make a release just tag the commit with appropriately formed version tag and the Release action will create a release with the archive as the attached artifact.
