[alias]
xdbg = "run --bin xdbg --"
xli = "run --bin xmtp_cli --"
update-schema = "run --bin update-schema --features update-schema"
bindgen = "run --bin ffi-uniffi-bindgen --features uniffi/cli"
bindgen-swift = "run --bin ffi-uniffi-bindgen-swift --features uniffi/cli"

# see: https://github.com/rust-lang/cargo/issues/5376#issuecomment-2163350032
# We use this instead of [build] because target.*.rustflags are merged by default
[target."cfg(all())"]
rustflags = ["--cfg", "tracing_unstable"]

[target.wasm32-unknown-unknown]
runner = 'wasm-bindgen-test-runner'
rustflags = [
  '--cfg',
  'getrandom_backend="wasm_js"',
  '-C',
  'target-feature=+bulk-memory,+mutable-globals',
]

# Android targets: 16KB page alignment for Android 15+ compatibility.
# Stack canary protection via -Z flag requires RUSTC_BOOTSTRAP=1 (set in CI).
# TODO: Replace "-Zstack-protector=strong" with "-Cstack-protector=strong" once stabilized.
# Tracking: https://github.com/rust-lang/rust/issues/114903
[target.aarch64-linux-android]
rustflags = ["-Clink-arg=-Wl,-z,max-page-size=16384", "-Zstack-protector=strong"]

[target.armv7-linux-androideabi]
rustflags = ["-Clink-arg=-Wl,-z,max-page-size=16384", "-Zstack-protector=strong"]

[target.i686-linux-android]
rustflags = ["-Clink-arg=-Wl,-z,max-page-size=16384", "-Zstack-protector=strong"]

[target.x86_64-linux-android]
rustflags = ["-Clink-arg=-Wl,-z,max-page-size=16384", "-Zstack-protector=strong"]

# Codegen units can also be set if needed
[profile.dev]
# build scripts don't need extra assertions
build-override = { opt-level = 3, debug = false, debug-assertions = false, overflow-checks = false, incremental = false }
# Build all non-local dependencies in release mode
package."*" = { opt-level = 3, debug = false, debug-assertions = false, overflow-checks = false, incremental = false }
# It uses debug_assertions internally to decide whether to choose where to use `max_level_*` or `release_max_level_*`
package.tracing = { opt-level = 3, debug = false, debug-assertions = true, overflow-checks = false, incremental = false }

[profile.test]
# build scripts don't need extra assertions
build-override = { opt-level = 3, debug = false, debug-assertions = false, overflow-checks = false, incremental = false }
# Build all non-local dependencies in release mode
package."*" = { opt-level = 3, debug = false, debug-assertions = false, overflow-checks = false, incremental = false }
# It uses debug_assertions internally to decide whether to choose where to use `max_level_*` or `release_max_level_*`
package.tracing = { opt-level = 3, debug = false, debug-assertions = true, overflow-checks = false, incremental = false }
