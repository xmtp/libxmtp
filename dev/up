#!/bin/bash
set -eou pipefail

if [[ "${OSTYPE}" == "darwin"* ]]; then
    if ! which buf &>/dev/null; then brew install buf; fi
    if ! which shellcheck &>/dev/null; then brew install shellcheck; fi
    if ! which markdownlint &>/dev/null; then brew install markdownlint-cli; fi
    if ! java -version &>/dev/null; then
        brew install java
        sudo ln -sfn /opt/homebrew/opt/openjdk/libexec/openjdk.jdk \
            /Library/Java/JavaVirtualMachines/
    fi
    if ! kotlinc -version &>/dev/null; then brew install kotlin; fi
    if ! swiftformat -version &>/dev/null; then brew install swiftformat; fi
    if ! which foundryup &>/dev/null; then  
        # install foundry for tests that require mocking blockchain
        curl -L https://foundry.paradigm.xyz | bash
        # you may need to adjust this depending on which $SHELL you use 
        source $HOME/.zshenv
        foundryup
    fi
    if ! wasm-pack --version &>/dev/null; then cargo install wasm-pack; fi
fi

rustup update

dev/build_validation_service_local
dev/docker/up
