#!/bin/bash
# Build Android bindings (.so libraries + Kotlin bindings) via Nix
source "$(dirname "$0")/.setup"

# --release builds all 4 ABIs; default builds only host-matching target
if [[ "${1:-}" == "--release" ]]; then
    PACKAGE="android-libs"
    echo "Building Android bindings (all targets)..."
else
    PACKAGE="android-libs-fast"
    echo "Building Android bindings (host target only)..."
fi

# Build via Nix â€” output is Gradle-ready, symlinked directly
nix build "${ROOT}#${PACKAGE}" --out-link "${SDK_ROOT}/.build/bindings"

echo "Android bindings built successfully:"
echo "  Kotlin: ${SDK_ROOT}/.build/bindings/java/uniffi/xmtpv3/xmtpv3.kt"
echo "  JNI libs: ${SDK_ROOT}/.build/bindings/jniLibs/"
